<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<project basedir="." default="build" name="LODE">
  <property environment="env"/>
  <property name="env.SERVLET_DIR" value="/usr/share/tomcat7/lib"/>
  <property name="env.SERVLET_JAR" value="servlet-api.jar"/>
  <property name="env.APP_VERSION" value="2.0.0.SNAPSHOT"/>
  <property name="env.WARFILE" value="out/LODE-${env.APP_VERSION}.war"/>

  <target name="mvn-init" unless="compile.classpath" xmlns:artifact="urn:maven-artifact-ant">    
    <typedef resource="org/apache/maven/artifact/ant/antlib.xml" uri="urn:maven-artifact-ant" classpath="lib/maven-ant-tasks.jar"/> 
    <condition property="maven.repo.local" value="${maven.repo.local}" else="${user.home}/.m2/repository">
      <isset property="maven.repo.local"/>
    </condition>           
    <echo>maven.repo.local=${maven.repo.local}</echo>
    <artifact:localRepository id="local.repository" path="${maven.repo.local}"/> 
    <artifact:pom file="pom.xml" id="maven.project"/>
    <artifact:dependencies pathId="compile.classpath" filesetId="compile.fileset" useScope="compile">
      <pom refid="maven.project"/>
      <localRepository refid="local.repository"/>
    </artifact:dependencies>
    <artifact:dependencies pathId="test.classpath" filesetId="test.fileset" useScope="test">
      <pom refid="maven.project"/>
      <localRepository refid="local.repository"/>
    </artifact:dependencies>
    <artifact:dependencies pathId="runtime.classpath" filesetId="runtime.fileset" useScope="runtime">
      <pom refid="maven.project"/>
      <localRepository refid="local.repository"/>
    </artifact:dependencies>
  </target>
  <target name="clean">
    <delete dir="build" />
  </target>
  <target name="compile" depends="mvn-init,clean">
    <mkdir dir="build" />
    <copy todir="build">
      <fileset dir="src/main/webapp">
      </fileset>
    </copy>  	
    <mkdir dir="build/WEB-INF/classes" />
    <javac destdir="build/WEB-INF/classes" srcdir="src/main/java" classpathref="compile.classpath" includeantruntime="false" debug="true">
      <compilerarg value="-Xlint:deprecation"/>
  	  <!--
      <classpath>
        <fileset dir="build/WEB-INF/lib">
          <include name="*" />
        </fileset>
        <fileset dir="${env.SERVLET_DIR}">
          <include name="${env.SERVLET_JAR}"/>
        </fileset>
      </classpath>
      -->
    </javac>
    <copy todir="build/WEB-INF/classes">
      <fileset dir="src/main/java">
        <exclude name="**/*.java" />
      </fileset>
    </copy>
  	<tstamp>
  	  <format property="TODAY" pattern="yyyy-MM-dd HH:mm:ss" />
    </tstamp>
  	<manifest file="build/META-INF/MANIFEST.MF">
  	  <attribute name="Application-Version" value="${env.APP_VERSION}"/>
	  <attribute name="Build-Date" value="${TODAY}"/>                 
  	</manifest>
  </target>
  <target name="war" depends="compile">
    <war basedir="build" destfile="${env.WARFILE}" webxml="build/WEB-INF/web.xml">
      <webinf dir="build/WEB-INF/">
        <include name="**/*.jar" />
      </webinf>
    </war>
  </target>
  <target name="build" depends="compile">
  </target>	
</project>
